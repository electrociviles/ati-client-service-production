(this.webpackJsonpati=this.webpackJsonpati||[]).push([[18],{1106:function(e,t,a){"use strict";a.r(t);var n=a(14),r=a(1),c=a.n(r),l=a(931),i=a(114),s=a(71),o=a(935),u=a(1083),m=a(1084);function d(){var e=Object(u.a)(["\n  query reportsServices($start: Int, $end: Int, $startDate: Date, $endDate: Date, $status: String, $type: Int) {\n    reportsServices(start: $start, end: $end, startDate: $startDate, endDate: $endDate, status: $status, type: $type) {\n        services {\n            id\n            latitude\n            longitude\n            date\n            typeService\n            packs_service {\n                quantity\n                pack {\n                price\n                }\n            }\n            customer {\n                names\n            }\n            technical {\n                names\n            }\n            engineer {\n                names\n            }\n        }\n        totalFields\n      }\n}"]);return d=function(){return e},e}a.n(m)()(d());var p=a(48),E=a(204),g=a(265),b=a(266),f=a(26),v=a(941),h=a(936),O=a(957),y=a(942),j=a(36),S=a(5),D=a.n(S),w=a(1085),C=a.n(w),x=a(1020),H=a(15),k=(a(16),a(711)),N=a(713),_=a(712),T=a(939),Y=a(484),P=(a(3),a(560)),$=a(65),M=a(173),A=a.n(M),z=a(552),I=a(147),F=a(473),R=a(474),B=a(559),W=a(558),q=a(940),G=a(937),J=a(1021),K=a(934),L=a(1098),Q=a(385),U=a(66),V=a(82),X=a(1017),Z=a(1004),ee=Object(l.a)((function(e){return{root:{flexGrow:1,height:250,minWidth:290},input:{display:"flex",padding:0,height:"auto"},paper:{padding:e.spacing(2),color:e.palette.text.secondary,marginTop:10,margin:5},button:{margin:e.spacing(1)},formControl:{margin:e.spacing(1)},icon:{width:24,height:24}}}));t.default=function(e){D()().locale("es");var t=Object(r.useState)(0),a=Object(n.a)(t,2),l=a[0],u=a[1],m=Object(r.useState)(10),d=Object(n.a)(m,2),S=d[0],w=d[1],M=Object(r.useState)(0),te=Object(n.a)(M,2),ae=te[0],ne=te[1],re=ee(),ce=Object(r.useState)(new Date),le=Object(n.a)(ce,2),ie=le[0],se=le[1],oe=Object(r.useState)(new Date),ue=Object(n.a)(oe,2),me=ue[0],de=ue[1],pe=Object(r.useState)(!1),Ee=Object(n.a)(pe,2),ge=Ee[0],be=Ee[1],fe=Object(r.useState)(""),ve=Object(n.a)(fe,2),he=ve[0],Oe=ve[1],ye=Object(r.useState)([]),je=Object(n.a)(ye,2),Se=je[0],De=je[1],we=Object(r.useState)(0),Ce=Object(n.a)(we,2),xe=Ce[0],He=Ce[1],ke=Object(r.useState)(1),Ne=Object(n.a)(ke,2),_e=Ne[0],Te=Ne[1],Ye=Object(r.useState)(""),Pe=Object(n.a)(Ye,2),$e=Pe[0],Me=Pe[1],Ae=Object(r.useState)([]),ze=Object(n.a)(Ae,2),Ie=ze[0],Fe=ze[1],Re=Object(r.useState)([]),Be=Object(n.a)(Re,2),We=Be[0],qe=Be[1],Ge=Object(r.useState)(""),Je=Object(n.a)(Ge,2),Ke=Je[0],Le=Je[1],Qe=Object(r.useState)([]),Ue=Object(n.a)(Qe,2),Ve=Ue[0],Xe=Ue[1],Ze=Object(r.useState)(""),et=Object(n.a)(Ze,2),tt=et[0],at=et[1],nt=Object(r.useState)(!1),rt=Object(n.a)(nt,2),ct=rt[0],lt=rt[1],it=Object(r.useState)(null),st=Object(n.a)(it,2),ot=st[0],ut=st[1],mt=Object(r.useState)(!1),dt=Object(n.a)(mt,2),pt=dt[0],Et=dt[1],gt=Object(r.useState)(""),bt=Object(n.a)(gt,2),ft=bt[0],vt=bt[1],ht=Object(r.useState)(!1),Ot=Object(n.a)(ht,2),yt=Ot[0],jt=Ot[1],St=Object(r.useState)(""),Dt=Object(n.a)(St,2),wt=Dt[0],Ct=Dt[1],xt=Object(r.useState)(!1),Ht=Object(n.a)(xt,2),kt=Ht[0],Nt=Ht[1];Object(r.useEffect)((function(){var e=A()(localStorage.getItem("token"));Object($.o)().then((function(e){var t=function(e,t){var a=t.slice();return a.unshift(e),a}({_id:"1",type:"Todas",status:"active",tag:""},e.attentionsTypes);Fe(t)}));var t={};"5a046fe9627e3526802b3847"==e.role&&(t.customer=""),"5a046fe9627e3526802b3848"==e.role&&(t.customer=e.id),"627d968a96a6a6b76f30c7e9"==e.role&&(t.encargado=!0,t.user=e.id),Object($.u)(t).then((function(e){console.log("response",e),qe(e.customers)}))}),[]);var _t=function(e){var t=void 0!==e?e:Ke;return null==t||""===t.toString().trim()?(Et(!0),vt("Este campo es requerido"),1):(Et(!1),vt(""),0)},Tt=function(e){var t=void 0!==e?e:tt;return null==t||""===t.toString().trim()?(jt(!0),Ct("Este campo es requerido"),1):(jt(!1),Ct(""),0)},Yt=function(){be(!1)},Pt=function(e){if(0===function(){var e=0,t=A()(localStorage.getItem("token"));return"5a046fe9627e3526802b3847"!==t.role&&(e+=_t()),"627d968a96a6a6b76f30c7e9"==t.role&&(e+=Tt()),e}()){var t={start:0,end:S,paginate:!0,startDate:ie,endDate:me,customer:Ke,centerOfAttention:tt,serviceType:_e,serviceStatus:$e};Object($.H)(t).then((function(e){var t=0;ne(e.count);var a=e.attentions.map((function(e,a){return console.log("service ",e.total),e.total&&(t+=e.total),e}));De(a),He(t)}))}},$t=function(e){return function(){lt(!0),ut(e)}},Mt=function(){lt(!1)},At=function(e){switch(e.statusSend){case"send":return c.a.createElement("div",{className:"wrapper__history"},c.a.createElement("div",{className:"statusHistory"},"Enviado"),c.a.createElement("div",{className:"dateHistory"},D()(e.date).format("YYYY-MM-DD HH:mm:ss")));case"resend":return c.a.createElement("div",{className:"wrapper__history"},c.a.createElement("div",{className:"statusHistory"},"Reenviado"),c.a.createElement("div",{className:"dateHistory"},D()(e.date).format("YYYY-MM-DD HH:mm:ss")));case"reject":return c.a.createElement("div",{className:"wrapper__history"},c.a.createElement("div",{className:"statusHistory"},"Rechazado"),c.a.createElement("div",{className:"dateHistory"},D()(e.date).format("YYYY-MM-DD HH:mm:ss")));case"accept":return c.a.createElement("div",{className:"wrapper__history"},c.a.createElement("div",{className:"statusHistory"},"Aceptado"),c.a.createElement("div",{className:"dateHistory"},D()(e.date).format("YYYY-MM-DD HH:mm:ss")))}},zt=function(e){return function(){var t=Se.map((function(t){return t._id===e._id&&(t.downloading=!0),t}));De(t);var a={id:e._id};Object($.y)(a).then((function(t){var a=Se.map((function(t){return t._id===e._id&&(t.downloading=!1),t}));De(a),console.log(t),"success"===t.status?(Z.b.info(t.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),De(a),window.open("".concat(H.a.urlPdf).concat(e._id,".pdf"))):Z.b.error(t.message,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})})).catch((function(e){Z.b.error("Occurri\xf3 un error al descargar la atenci\xf3n",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}))}};return c.a.createElement(r.Fragment,null,c.a.createElement(Z.a,null),c.a.createElement(o.a,{maxWidth:"lg"},c.a.createElement(i.a,{className:re.paper},c.a.createElement("form",{encType:"multipart/form-data",onSubmit:function(e){e.preventDefault(),Pt()}},c.a.createElement(s.a,{container:!0},c.a.createElement(s.a,{item:!0,xs:12,sm:12},c.a.createElement(p.a,null,"Reporte de atenciones")),c.a.createElement(s.a,{item:!0,xs:12,sm:3},c.a.createElement(K.a,{utils:J.a},c.a.createElement(L.a,{disableFuture:!0,format:"yyyy-MM-dd",margin:"dense",id:"date-picker-inline",label:"Fecha inicial",value:ie,onChange:function(e){se(e)},KeyboardButtonProps:{"aria-label":"change date"}}))),c.a.createElement(s.a,{item:!0,xs:12,sm:3},c.a.createElement(K.a,{utils:J.a},c.a.createElement(L.a,{format:"yyyy-MM-dd",margin:"dense",id:"date-picker-inline",label:"Fecha final",value:me,onChange:function(e){de(e)},KeyboardButtonProps:{"aria-label":"change date"}}))),c.a.createElement(s.a,{item:!0,xs:12,sm:3},c.a.createElement(Y.a,{select:!0,style:{width:200},variant:"outlined",margin:"dense",label:"Cliente",error:pt,helperText:ft,value:Ke,onChange:function(e){var t=A()(localStorage.getItem("token")),a={};"5a046fe9627e3526802b3847"==t.role&&(a.customer=""),"5a046fe9627e3526802b3848"==t.role&&(a.customer=e.target.value),"627d968a96a6a6b76f30c7e9"==t.role&&(a.encargado=!0,a.user=t.id),console.log("filters",a),Le(e.target.value),Object($.t)(a).then((function(e){Xe(e.centersOfAttention)}))}},We.map((function(e){return c.a.createElement(P.a,{key:e._id,value:e._id},e.name)})))),c.a.createElement(s.a,{item:!0,xs:12,sm:3},c.a.createElement(Y.a,{select:!0,style:{width:200},variant:"outlined",margin:"dense",label:"Centro de atenci\xf3n",error:yt,helperText:wt,value:tt,onChange:function(e){at(e.target.value)}},Ve.map((function(e){return c.a.createElement(P.a,{key:e._id,value:e._id},e.title)})))),c.a.createElement(s.a,{item:!0,xs:12,sm:3},c.a.createElement(Y.a,{select:!0,style:{width:200},variant:"outlined",margin:"dense",label:"Tipo de atenci\xf3n",value:_e,onChange:function(e){Te(e.target.value)}},Ie.map((function(e){return c.a.createElement(P.a,{key:e._id,value:e._id},e.type)})))),c.a.createElement(s.a,{item:!0,xs:2,sm:3},c.a.createElement(Y.a,{select:!0,style:{width:200},variant:"outlined",margin:"dense",label:"Estado de la atenci\xf3n",value:$e,onChange:function(e){Me(e.target.value)}},[{id:"",text:"Todas"},{id:"accept",text:"Aceptada"},{id:"reject",text:"Rechazada"},{id:"resend",text:"Reenviada"}].map((function(e){return c.a.createElement(P.a,{key:e.id,value:e.id},e.text)})))),c.a.createElement(s.a,{item:!0,xs:2,sm:12},c.a.createElement(E.a,{type:"submit",variant:"contained",color:"primary",style:{marginTop:20}},"Consultar")))))),c.a.createElement(i.a,{className:re.paper},c.a.createElement(v.a,{className:re.container,style:{width:"100%"}},c.a.createElement(g.a,{stickyHeader:!0,"aria-label":"sticky table"},c.a.createElement(h.a,null,c.a.createElement(j.a,null,c.a.createElement(f.a,null,"Fecha"),c.a.createElement(f.a,null,"Tipo"),c.a.createElement(f.a,null,"Cliente"),c.a.createElement(f.a,null,"Nombre"),c.a.createElement(f.a,null,"Descripci\xf3n"),c.a.createElement(f.a,null,"Centro de atenci\xf3n"),c.a.createElement(f.a,{width:30},"Historial"),c.a.createElement(f.a,{width:30},"Descargar"),c.a.createElement(f.a,{width:30,align:"right"},"Total"))),c.a.createElement(b.a,null,Se.map((function(e){return c.a.createElement(j.a,{hover:!0,key:e._id},c.a.createElement(f.a,null,c.a.createElement(C.a,{format:"ll"},new Date(e.date))),c.a.createElement(f.a,null,e.attentionType.type),c.a.createElement(f.a,null,e.customer.name),c.a.createElement(f.a,null,e.title),c.a.createElement(f.a,null,e.description),c.a.createElement(f.a,null,e.centerOfAttention?e.centerOfAttention.title:""),c.a.createElement(f.a,{className:re.iconWidth},e.descriptions.length>0?c.a.createElement(z.a,{title:"Hisotoria",placement:"top"},c.a.createElement("div",null,c.a.createElement(I.b,{className:"icon",onClick:$t(e)}))):""),c.a.createElement(f.a,{className:re.iconWidth},c.a.createElement(z.a,{title:"Descargar",placement:"top"},e.downloading?c.a.createElement("div",{className:"circularProgress"},c.a.createElement(G.a,{size:16})):c.a.createElement("div",null,c.a.createElement(U.c,{className:"icon",onClick:zt(e)})))),c.a.createElement(f.a,{align:"right"},c.a.createElement(x.a,{value:e.total,displayType:"text",thousandSeparator:!0,prefix:"$"})))}))),Se.length>0?c.a.createElement(O.a,null,c.a.createElement(j.a,{hover:!0},c.a.createElement(f.a,null,kt?c.a.createElement(G.a,{size:16}):c.a.createElement(Q.b,{className:re.icon,onClick:function(){Nt(!0);var e={start:0,end:S,paginate:!0,startDate:ie,endDate:me,customer:Ke,centerOfAttention:tt,serviceType:_e,serviceStatus:$e};Object($.G)(e).then((function(e){if(Nt(!1),"success"===e.status){var t="data:application/pdf;base64,"+e.data;Oe(t),be(!0)}})).catch((function(e){console.log(e),Nt(!1)}))}})),c.a.createElement(f.a,{colSpan:7,align:"right"},c.a.createElement(p.a,{variant:"h3"},c.a.createElement(x.a,{value:xe,displayType:"text",thousandSeparator:!0,prefix:"$"}))))):null)),c.a.createElement(y.a,{rowsPerPageOptions:[10,25,100],component:"div",count:ae,rowsPerPage:S,page:l,onChangePage:function(e,t){var a={start:t*S,end:S,paginate:!0,startDate:ie,endDate:me,customer:Ke,centerOfAttention:tt,serviceType:_e,serviceStatus:$e};u(t),Object($.H)(a).then((function(e){De(e.attentions),ne(e.count)}))},onChangeRowsPerPage:function(e){w(+e.target.value),u(0);var t={start:0,end:e.target.value,paginate:!0,startDate:ie,endDate:me,customer:Ke,centerOfAttention:tt,serviceType:_e,serviceStatus:$e};Object($.H)(t).then((function(e){De(e.attentions),ne(e.count)}))}})),c.a.createElement(k.a,{maxWidth:"lg",open:ge,onClose:Yt,"aria-labelledby":"draggable-dialog-title"},c.a.createElement(T.a,{id:"draggable-dialog-title"},"Reporte de servicios"),c.a.createElement(_.a,null,c.a.createElement("iframe",{src:he,title:"Imprimir",height:"900px",width:"600px"})),c.a.createElement(N.a,null,c.a.createElement(E.a,{onClick:Yt,color:"primary"},"Cerrar"))),c.a.createElement(k.a,{open:ct,onClose:Mt},c.a.createElement(T.a,null,"Historia"),c.a.createElement(_.a,null,c.a.createElement(q.a,null,c.a.createElement(F.a,{className:re.root},ot?ot.descriptions.map((function(e){return c.a.createElement(R.a,{alignItems:"flex-start"},c.a.createElement(W.a,null,function(e){switch(e){case"reject":return c.a.createElement(U.b,{style:{fontSize:32,color:"red"}});case"send":return c.a.createElement(V.d,{style:{fontSize:32,color:"red"}});case"accept":return c.a.createElement(U.a,{style:{fontSize:32,color:"green"}});case"resend":return c.a.createElement(X.a,{style:{fontSize:32,color:"silver"}})}}(e.statusSend)),c.a.createElement(B.a,{primary:At(e),secondary:e.description}))})):""))),c.a.createElement(N.a,null,c.a.createElement(E.a,{autoFocus:!0,onClick:Mt,color:"primary"},"Cerrar"))))}}}]);
//# sourceMappingURL=18.b5a5b8bd.chunk.js.map